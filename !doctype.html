<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>卡牌構築原型</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial; margin: 16px; }
    .container { display: flex; gap: 24px; }
    .panel { border: 1px solid #ddd; padding: 12px; border-radius: 8px; width: 100%; }
    .cards { display:flex; flex-wrap:wrap; gap:8px; }
    .card { width:140px; padding:8px; border:1px solid #ccc; border-radius:6px; background:#fff; cursor:pointer; user-select:none; }
    .card img { width:100%; height:90px; object-fit:cover; border-radius:4px; }
    .deck-list { margin-top:8px; display:flex; flex-direction:column; gap:6px; }
    .deck-item { display:flex; justify-content:space-between; gap:8px; align-items:center; padding:6px; border-radius:6px; background:#f8f9fb; }
    button { padding:6px 10px; border-radius:6px; border:1px solid #bbb; background:#fff; cursor:pointer; }
    .controls { display:flex; gap:8px; margin-top:8px; }
    input[type="search"]{ padding:6px; border-radius:6px; border:1px solid #ccc; width:220px; }
    pre { background:#0f1724; color:#cbd5e1; padding:8px; border-radius:6px; overflow:auto; max-height:200px; }
  </style>
</head>
<body>
  <h2>卡牌構築原型</h2>
  <p>點擊卡片加入卡組。卡組支援計數、移除與匯出 JSON。</p>

  <div class="controls">
    <input id="search" type="search" placeholder="搜尋卡名或類型" />
    <button id="clear">清除卡組</button>
    <button id="export">匯出 JSON</button>
  </div>

  <div class="container" style="margin-top:12px;">
    <div class="panel" style="flex:2;">
      <h3>卡池</h3>
      <div id="cards" class="cards"></div>
    </div>

    <div class="panel" style="flex:1;">
      <h3>卡組（上限 40 張示範）</h3>
      <div id="deck" class="deck-list"></div>
      <div style="margin-top:8px; font-size:0.9em; color:#555;">
        共 <span id="deck-count">0</span> 張
      </div>
      <h4 style="margin-top:12px">匯入 / 貼上 JSON</h4>
      <textarea id="importArea" rows="6" style="width:100%;"></textarea>
      <div style="margin-top:6px; display:flex; gap:8px;">
        <button id="import">匯入</button>
        <button id="sample">載入示範卡池</button>
      </div>
    </div>
  </div>

  <h3 style="margin-top:16px">匯出結果</h3>
  <pre id="output">[]</pre>

<script>
  // 最簡單的示範卡池資料
  const initialCards = [
    { id: 'c001', name: '火焰使者', type: '攻擊', cost: 2, img: 'https://picsum.photos/seed/fire/400/240' },
    { id: 'c002', name: '治癒精靈', type: '輔助', cost: 1, img: 'https://picsum.photos/seed/heal/400/240' },
    { id: 'c003', name: '巨石戰士', type: '防禦', cost: 3, img: 'https://picsum.photos/seed/stone/400/240' },
    { id: 'c004', name: '雷光斬', type: '攻擊', cost: 4, img: 'https://picsum.photos/seed/light/400/240' },
    { id: 'c005', name: '魅惑術士', type: '控制', cost: 2, img: 'https://picsum.photos/seed/charm/400/240' },
    { id: 'c006', name: '抽牌學徒', type: '技巧', cost: 1, img: 'https://picsum.photos/seed/draw/400/240' },
  ];

  let cards = [...initialCards];
  const deck = {}; // {cardId: count}

  const cardsEl = document.getElementById('cards');
  const deckEl = document.getElementById('deck');
  const deckCountEl = document.getElementById('deck-count');
  const outputEl = document.getElementById('output');
  const searchEl = document.getElementById('search');
  const importArea = document.getElementById('importArea');

  function renderCards(list) {
    cardsEl.innerHTML = '';
    list.forEach(c => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${c.img}" alt="${c.name}" />
        <div style="margin-top:6px;">
          <strong>${c.name}</strong>
          <div style="font-size:0.9em;color:#666">${c.type} • 成本 ${c.cost}</div>
        </div>
      `;
      card.addEventListener('click', () => addToDeck(c.id));
      cardsEl.appendChild(card);
    });
  }

  function renderDeck() {
    deckEl.innerHTML = '';
    const items = Object.entries(deck);
    items.forEach(([id, count]) => {
      const card = cards.find(c => c.id === id) || { name: id };
      const item = document.createElement('div');
      item.className = 'deck-item';
      item.innerHTML = `
        <div style="flex:1;">
          <strong>${card.name}</strong>
          <div style="font-size:0.85em;color:#666">${card.type || ''}</div>
        </div>
        <div style="display:flex;gap:6px;align-items:center">
          <button data-action="dec">−</button>
          <div>${count}</div>
          <button data-action="inc">＋</button>
          <button data-action="rm" style="margin-left:8px;color:#a33">移除</button>
        </div>
      `;
      item.querySelector('[data-action="dec"]').addEventListener('click', () => changeCount(id, -1));
      item.querySelector('[data-action="inc"]').addEventListener('click', () => changeCount(id, +1));
      item.querySelector('[data-action="rm"]').addEventListener('click', () => removeFromDeck(id));
      deckEl.appendChild(item);
    });
    const total = items.reduce((s, [,c]) => s + c, 0);
    deckCountEl.textContent = total;
    outputEl.textContent = JSON.stringify(buildExport(), null, 2);
  }

  function addToDeck(id) {
    deck[id] = (deck[id] || 0) + 1;
    renderDeck();
  }
  function changeCount(id, delta) {
    deck[id] = Math.max(0, (deck[id] || 0) + delta);
    if (deck[id] === 0) delete deck[id];
    renderDeck();
  }
  function removeFromDeck(id) {
    delete deck[id];
    renderDeck();
  }

  function buildExport() {
    // 匯出完整卡片資訊與數量
    return Object.entries(deck).map(([id, count]) => {
      const card = cards.find(c => c.id === id) || { id, name: id };
      return { ...card, count };
    });
  }

  // 搜尋
  searchEl.addEventListener('input', () => {
    const q = searchEl.value.trim().toLowerCase();
    if (!q) return renderCards(cards);
    const filtered = cards.filter(c =>
      c.name.toLowerCase().includes(q) ||
      (c.type && c.type.toLowerCase().includes(q)) ||
      (''+c.cost).includes(q)
    );
    renderCards(filtered);
  });

  // 匯出
  document.getElementById('export').addEventListener('click', () => {
    const data = buildExport();
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'deck.json';
    a.click();
    URL.revokeObjectURL(url);
  });

  // 清除
  document.getElementById('clear').addEventListener('click', () => {
    Object.keys(deck).forEach(k => delete deck[k]);
    renderDeck();
  });

  // 匯入
  document.getElementById('import').addEventListener('click', () => {
    const txt = importArea.value.trim();
    if (!txt) return alert('請貼上要匯入的 JSON（陣列格式）');
    try {
      const arr = JSON.parse(txt);
      // 接受陣列或物件 {id:count}
      if (Array.isArray(arr)) {
        arr.forEach(it => {
          if (it.id && it.count) deck[it.id] = (deck[it.id] || 0) + Number(it.count);
        });
      } else if (typeof arr === 'object') {
        Object.entries(arr).forEach(([id, c]) => deck[id] = (deck[id] || 0) + Number(c));
      }
      renderDeck();
      alert('匯入完成');
    } catch (e) {
      alert('JSON 解析失敗: ' + e.message);
    }
  });

  document.getElementById('sample').addEventListener('click', () => {
    cards = [...initialCards];
    renderCards(cards);
    alert('示範卡池已載入');
  });

  // 初始 render
  renderCards(cards);
  renderDeck();
</script>
</body>
</html>